<!DOCTYPE html>
<html>
	<head>
		<link rel="icon" type="image/x-icon" href="/favicon.ico" />
		<link rel="stylesheet" type="text/css" href="/theme.css" />
		<script src="/background.js"></script>
		<link rel="stylesheet" type="text/css" href="/table.css" />
		<link rel="stylesheet" type="text/css" href="/badges.css" />
		<style>
h2 {
	color: white;
}
		</style>
	</head>
	<body>
		<div class="tabs"></div>
		<h1>Admin Board</h1>
		<h3>Applications:</h3>
		<div id="applications"></div>
		<h3>Update Event List:</h3>
		<p>To get the file, go to the Google Sheets event list, then click on File > Export > Comma Separated Values. Then upload the file here.</p>
		<p><input type="file" id="eventList"><button onclick="this.previousElementSibling.files[0].text().then((e) => uploadCSV(e))">Upload</button></p>
		<script src="/data.js"></script>
		<script src="/tabs.js"></script>
		<script>
tabs.extra(3, "Admin Board")
getData().then((info) => {
	tabs.userfix(info.profile);
	if (info.profile.length == 0) return location.replace("/")
	if (info.profile[0].admin == false) return location.replace("/")
});
// APPLICATION VIEWER CODE
(() => {
	var x = new XMLHttpRequest()
	x.open("GET", "/applications.txt" + location.search)
	x.addEventListener("loadend", (e) => {
		var t = e.target.responseText
		var h = t.replaceAll(/(Username: ([A-Za-z0-9 \._]+)\nEmail address: ([A-Za-z0-9@\.]+)?\n)(?!\[(Rejected|Accepted)\])/ig, "$1<button onclick=\"createprofile('$2', '$3')\">Accept</button><button onclick=\"rejectprofile('$2', '$3')\">Reject</button>\n")
		h = h.replaceAll(/^\n*$/ig, "There are no applications at the moment.")
		if (h == t) h += "\nThere are no valid applications at the moment."
		document.querySelector("#applications").innerHTML = h
	})
x.send()
})();
function createprofile(username, email) {
	var x = new XMLHttpRequest()
	x.open("POST", "/createuser")
	x.addEventListener("loadend", () => location.reload())
	x.send(`${username}\n${email}`)
}
function rejectprofile(username, email) {
	var x = new XMLHttpRequest()
	x.open("POST", "/rejectprofile")
	x.addEventListener("loadend", () => location.reload())
	x.send(`${username}\n${email}`)
}
// EVENT LIST CODE
function uploadCSV(data) {
	var x = new XMLHttpRequest()
	x.open("POST", "/upload_csv")
	x.addEventListener("loadend", () => location.replace("/"))
	x.send(location.search.substr(1) + "\n" + data)
}
		</script>
		<script src="https://matterjstest.jasonroman.repl.co/matter.js"></script>
		<script src="/matter2.js"></script>
	</body>
</html>